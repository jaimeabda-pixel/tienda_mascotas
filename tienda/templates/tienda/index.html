{% extends 'tienda/base.html' %}
{% load static humanize %}

{% block title %}Inicio - Tienda para Mascotas{% endblock %}

{% block content %}
<div class="ml-homepage fade-in-up">

  <!-- HEADER & STATS -->
  <div class="container-fluid px-4 mb-5">
    <div class="glass-header d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 p-4">
      <div>
        <h1 class="fw-bold mb-1 text-white">
          {% if role == 'admin' %}Panel de Control Global{% else %}Mi Tablero de Ventas{% endif %}
        </h1>
        <p class="mb-0 text-white-50">
          {% if role == 'admin' %}Visión general del negocio{% else %}Bienvenido, {{
          user.first_name|default:user.username }}{% endif %}
        </p>
      </div>
      <div class="text-end mt-3 mt-md-0">
        <h5 class="mb-0 text-white">{% now "l, d F Y" %}</h5>
        <small class="text-white-50">{% now "H:i" %}</small>
      </div>
    </div>

    <!-- STATS CARDS -->
    <div class="row g-4">
      {% if role == 'admin' %}
      <!-- ADMIN STATS -->
      <div class="col-md-3">
        <div class="stat-card-modern p-4 rounded-4 h-100">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <p class="text-muted mb-1">Ventas Hoy</p>
              <h3 class="fw-bold mb-0">{{ ventas_hoy }}</h3>
            </div>
            <div class="icon-box bg-primary bg-opacity-10 text-primary p-3 rounded-circle">
              <i class="fas fa-shopping-cart fa-lg"></i>
            </div>
          </div>
          <small class="text-success"><i class="fas fa-arrow-up me-1"></i>Global</small>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card-modern p-4 rounded-4 h-100">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <p class="text-muted mb-1">Ingresos Hoy</p>
              <h3 class="fw-bold mb-0">${{ ingresos_hoy|intcomma }}</h3>
            </div>
            <div class="icon-box bg-success bg-opacity-10 text-success p-3 rounded-circle">
              <i class="fas fa-dollar-sign fa-lg"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card-modern p-4 rounded-4 h-100">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <p class="text-muted mb-1">Vendedores Activos</p>
              <h3 class="fw-bold mb-0">{{ vendedores_activos }}</h3>
            </div>
            <div class="icon-box bg-info bg-opacity-10 text-info p-3 rounded-circle">
              <i class="fas fa-users fa-lg"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card-modern p-4 rounded-4 h-100">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <p class="text-muted mb-1">Comisión Pagada</p>
              <h3 class="fw-bold mb-0">${{ comision_total_pagada|intcomma }}</h3>
            </div>
            <div class="icon-box bg-warning bg-opacity-10 text-warning p-3 rounded-circle">
              <i class="fas fa-hand-holding-usd fa-lg"></i>
            </div>
          </div>
        </div>
      </div>

      {% else %}
      <!-- VENDOR STATS -->
      <div class="col-md-4">
        <div class="stat-card-modern p-4 rounded-4 h-100">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <p class="text-muted mb-1">Mis Ventas Hoy</p>
              <h3 class="fw-bold mb-0">{{ ventas_hoy_count }}</h3>
              <small class="text-muted">Total: ${{ total_vendido_hoy|intcomma }}</small>
            </div>
            <div class="icon-box bg-primary bg-opacity-10 text-primary p-3 rounded-circle">
              <i class="fas fa-tag fa-lg"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card-modern p-4 rounded-4 h-100">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <p class="text-muted mb-1">Mi Comisión (Mes)</p>
              <h3 class="fw-bold mb-0 text-success">${{ comision_mes|intcomma }}</h3>
            </div>
            <div class="icon-box bg-success bg-opacity-10 text-success p-3 rounded-circle">
              <i class="fas fa-coins fa-lg"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card-modern p-4 rounded-4 h-100">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <p class="text-muted mb-1">Meta Mensual</p>
              <h3 class="fw-bold mb-0">${{ meta|intcomma }}</h3>
            </div>
            <div class="icon-box bg-warning bg-opacity-10 text-warning p-3 rounded-circle">
              <i class="fas fa-trophy fa-lg"></i>
            </div>
          </div>
          <div class="progress mt-3" style="height: 8px;">
            <div class="progress-bar bg-gradient-warning" role="progressbar" style="width: {{ progreso_meta }}%"></div>
          </div>
          <small class="text-muted mt-2 d-block">{{ progreso_meta }}% completado</small>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Quick Access Cards Carousel (Mercado Libre Style) -->
  <div class="container-fluid px-4 mb-4">
    <h5 class="mb-3 fw-bold ps-2 border-start border-4 border-primary">Accesos Rápidos</h5>
    <div class="ml-carousel-wrapper">
      <!-- Arrows -->
      <button class="ml-carousel-arrow ml-carousel-arrow-left" id="scrollLeft"><i
          class="fas fa-chevron-left"></i></button>
      <button class="ml-carousel-arrow ml-carousel-arrow-right" id="scrollRight"><i
          class="fas fa-chevron-right"></i></button>

      <div class="ml-carousel" id="carousel">
        <!-- Common Cards -->
        <a href="{% url 'ventas_create' %}" class="ml-card-carousel">
          <div class="ml-icon-wrapper bg-ml-yellow">
            <i class="fas fa-cash-register fa-2x" style="color: #333;"></i>
          </div>
          <h6 class="ml-card-title">Nueva Venta</h6>
          <p class="ml-card-desc">Registrar venta rápida.</p>
        </a>

        <a href="{% url 'ventas_list' %}" class="ml-card-carousel">
          <div class="ml-icon-wrapper bg-ml-yellow">
            <i class="fas fa-history fa-2x" style="color: #333;"></i>
          </div>
          <h6 class="ml-card-title">Historial</h6>
          <p class="ml-card-desc">Ver mis ventas pasadas.</p>
        </a>

        <a href="{% url 'clientes_list' %}" class="ml-card-carousel">
          <div class="ml-icon-wrapper bg-ml-yellow">
            <i class="fas fa-users fa-2x" style="color: #333;"></i>
          </div>
          <h6 class="ml-card-title">Clientes</h6>
          <p class="ml-card-desc">Gestionar cartera.</p>
        </a>

        <a href="{% url 'perfil' %}" class="ml-card-carousel">
          <div class="ml-icon-wrapper" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <i class="fas fa-user-circle fa-2x" style="color: white;"></i>
          </div>
          <h6 class="ml-card-title">Mi Perfil</h6>
          <p class="ml-card-desc">Ver mis datos.</p>
        </a>

        {% if role == 'admin' %}
        <!-- Admin Only Cards -->
        <a href="{% url 'vendedores_list' %}" class="ml-card-carousel">
          <div class="ml-icon-wrapper bg-ml-yellow">
            <i class="fas fa-user-tie fa-2x" style="color: #333;"></i>
          </div>
          <h6 class="ml-card-title">Vendedores</h6>
          <p class="ml-card-desc">Gestión de personal.</p>
        </a>

        <a href="{% url 'productos_list' %}" class="ml-card-carousel">
          <div class="ml-icon-wrapper bg-ml-yellow">
            <i class="fas fa-box fa-2x" style="color: #333;"></i>
          </div>
          <h6 class="ml-card-title">Productos</h6>
          <p class="ml-card-desc">Inventario global.</p>
        </a>

        <a href="{% url 'graficos' %}" class="ml-card-carousel">
          <div class="ml-icon-wrapper bg-ml-yellow">
            <i class="fas fa-chart-line fa-2x" style="color: #333;"></i>
          </div>
          <h6 class="ml-card-title">Reportes</h6>
          <p class="ml-card-desc">Analíticas globales.</p>
        </a>

        <a href="{% url 'configuracion' %}" class="ml-card-carousel">
          <div class="ml-icon-wrapper bg-ml-yellow">
            <i class="fas fa-cog fa-2x" style="color: #333;"></i>
          </div>
          <h6 class="ml-card-title">Configuración</h6>
          <p class="ml-card-desc">Ajustes del sistema.</p>
        </a>
        {% endif %}

        <a href="{% url 'notificaciones' %}" class="ml-card-carousel">
          <div class="ml-icon-wrapper bg-ml-yellow">
            <i class="fas fa-bell fa-2x" style="color: #333;"></i>
          </div>
          <h6 class="ml-card-title">Alertas</h6>
          <p class="ml-card-desc">Ver notificaciones.</p>
        </a>
      </div>
    </div>
  </div>

  <!-- Recent Activity (Vendor) or Promo (Admin/Both) -->
  {% if role == 'vendedor' %}
  <div class="container-fluid px-4 mb-5">
    <h5 class="mb-3 fw-bold ps-2 border-start border-4 border-success">Últimas Ventas</h5>
    <div class="card glass-card border-0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0 align-middle">
            <thead class="bg-light">
              <tr>
                <th class="ps-4">ID</th>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Total</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              {% for venta in ultimas_ventas %}
              <tr>
                <td class="ps-4 fw-bold">#{{ venta.id }}</td>
                <td>{{ venta.fecha|date:"d/m/Y H:i" }}</td>
                <td>{{ venta.cliente.nombre|default:"General" }}</td>
                <td class="fw-bold text-success">${{ venta.total|intcomma }}</td>
                <td><span class="badge bg-success bg-opacity-10 text-success px-3 py-2 rounded-pill">Pagada</span></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center py-4 text-muted">No has realizado ventas recientes.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Premium Promotional Carousel (Keep for everyone as it looks good) -->
  <div class="container-fluid px-4 mb-5">
    <div id="promoCarousel" class="carousel slide premium-carousel" data-bs-ride="carousel">
      <div class="carousel-indicators premium-indicators">
        <button type="button" data-bs-target="#promoCarousel" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#promoCarousel" data-bs-slide-to="1"></button>
      </div>

      <div class="carousel-inner premium-carousel-inner">
        <!-- Slide 1 -->
        <div class="carousel-item active">
          <div class="premium-slide bg-gradient-dark">
            <div class="premium-slide-overlay"></div>
            <div class="container h-100 position-relative">
              <div class="row align-items-center h-100">
                <div class="col-md-7 text-white p-4 p-md-5 premium-content">
                  <div class="premium-badge mb-3"><i class="fas fa-star me-2"></i><span>PREMIUM POS</span></div>
                  <h1 class="premium-title mb-3">SISTEMA MODERNO</h1>
                  <p class="premium-subtitle mb-4">Gestiona tu negocio con estilo y eficiencia.</p>
                </div>
                <div class="col-md-5 d-none d-md-flex justify-content-center">
                  <i class="fas fa-rocket fa-8x text-white opacity-50"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Slide 2 -->
        <div class="carousel-item">
          <div class="premium-slide bg-gradient-blue">
            <div class="premium-slide-overlay"></div>
            <div class="container h-100 position-relative">
              <div class="row align-items-center h-100">
                <div class="col-md-7 text-white p-4 p-md-5 premium-content">
                  <div class="premium-badge premium-badge-info mb-3"><i
                      class="fas fa-chart-pie me-2"></i><span>ANÁLISIS</span></div>
                  <h1 class="premium-title mb-3">CONTROL TOTAL</h1>
                  <p class="premium-subtitle mb-4">Visualiza tus metas y comisiones en tiempo real.</p>
                </div>
                <div class="col-md-5 d-none d-md-flex justify-content-center">
                  <i class="fas fa-chart-bar fa-8x text-white opacity-50"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<style>
  /* Mercado Libre Inspired Styles */
  .ml-homepage {
    padding-bottom: 3rem;
  }

  .ml-carousel-wrapper {
    position: relative;
    margin: 0 auto;
    max-width: 100%;
  }

  .ml-carousel {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-behavior: smooth;
    padding: 1rem;
    scrollbar-width: none;
  }

  .ml-carousel::-webkit-scrollbar {
    display: none;
  }

  .ml-carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #ffe600;
    border: 2px solid rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 100;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
    transition: all 0.3s;
  }

  .ml-carousel-arrow:hover {
    transform: translateY(-50%) scale(1.1);
  }

  .ml-carousel-arrow-left {
    left: 10px;
  }

  .ml-carousel-arrow-right {
    right: 10px;
  }

  .ml-card-carousel {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1.5rem 1rem;
    text-decoration: none;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    min-width: 180px;
    max-width: 180px;
    flex-shrink: 0;
  }

  .ml-card-carousel:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-md);
    background: var(--bg-surface-hover);
  }

  .ml-icon-wrapper {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
  }

  .bg-ml-yellow {
    background: #ffe600;
  }

  .ml-card-title {
    font-weight: 700;
    color: var(--text-main);
    margin-bottom: 0.5rem;
    font-size: 1rem;
  }

  .ml-card-desc {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-bottom: 0;
  }

  /* Premium Carousel */
  .premium-carousel {
    border-radius: 24px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
  }

  .premium-slide {
    min-height: 300px;
    display: flex;
    align-items: center;
    position: relative;
  }

  .bg-gradient-dark {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .bg-gradient-blue {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  }

  .premium-slide-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.2);
  }

  .premium-content {
    z-index: 2;
    position: relative;
  }

  .premium-badge {
    display: inline-block;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50px;
    font-weight: 700;
    font-size: 0.8rem;
    backdrop-filter: blur(5px);
    color: white;
  }

  .premium-title {
    font-size: 2.5rem;
    font-weight: 800;
  }

  .premium-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
  }
</style>

<script>
  // Carousel Logic
  document.addEventListener('DOMContentLoaded', function () {
    const carousel = document.getElementById('carousel');
    const scrollLeftBtn = document.getElementById('scrollLeft');
    const scrollRightBtn = document.getElementById('scrollRight');

    if (carousel && scrollLeftBtn && scrollRightBtn) {
      scrollRightBtn.addEventListener('click', () => carousel.scrollBy({ left: 250, behavior: 'smooth' }));
      scrollLeftBtn.addEventListener('click', () => carousel.scrollBy({ left: -250, behavior: 'smooth' }));
    }
  });
</script>
{% endblock %}