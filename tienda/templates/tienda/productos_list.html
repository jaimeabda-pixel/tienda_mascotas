{% extends 'tienda/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Inventario de Productos{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">

  <!-- Header & Actions -->
  <div
    class="glass-header d-flex justify-content-between align-items-center mb-4 animate__animated animate__fadeInDown">
    <div>
      <h2 class="fw-bold mb-1">Inventario</h2>
      <p class="opacity-75 mb-0">Gestiona tu cat치logo de productos</p>
    </div>
    <a href="{% url 'productos_create' %}" class="btn btn-primary btn-lg shadow-lg d-flex align-items-center gap-2"
      style="border-radius: 50px; padding: 0.8rem 1.5rem;">
      <i class="fas fa-plus-circle"></i>
      <span>Nuevo Producto</span>
    </a>
  </div>

  <!-- Stats Cards -->
  <div class="row g-4 mb-5 animate__animated animate__fadeInUp">
    <!-- Total Productos -->
    <div class="col-md-4">
      <div class="glass-card p-4 h-100 position-relative overflow-hidden">
        <div class="position-absolute top-0 end-0 p-3 opacity-10">
          <i class="fas fa-box-open fa-4x text-primary"></i>
        </div>
        <div class="d-flex flex-column position-relative z-1">
          <span class="text-muted text-uppercase small fw-bold mb-2">Total Productos</span>
          <h3 class="text-main fw-bold mb-0">{{ total_productos }}</h3>
          <span class="text-success small mt-2"><i class="fas fa-check me-1"></i>Activos en cat치logo</span>
        </div>
      </div>
    </div>

    <!-- Valor Inventario -->
    <div class="col-md-4">
      <div class="glass-card p-4 h-100 position-relative overflow-hidden">
        <div class="position-absolute top-0 end-0 p-3 opacity-10">
          <i class="fas fa-coins fa-4x text-warning"></i>
        </div>
        <div class="d-flex flex-column position-relative z-1">
          <span class="text-muted text-uppercase small fw-bold mb-2">Valor del Inventario</span>
          <h3 class="text-main fw-bold mb-0 text-warning">
            ${{ total_valor_inventario|floatformat:0|intcomma }}
          </h3>
          <span class="text-warning small mt-2"><i class="fas fa-chart-pie me-1"></i>Estimado</span>
        </div>
      </div>
    </div>

    <!-- Stock Bajo -->
    <div class="col-md-4">
      <div class="glass-card p-4 h-100 position-relative overflow-hidden">
        <div class="position-absolute top-0 end-0 p-3 opacity-10">
          <i class="fas fa-exclamation-triangle fa-4x text-danger"></i>
        </div>
        <div class="d-flex flex-column position-relative z-1">
          <span class="text-muted text-uppercase small fw-bold mb-2">Stock Bajo</span>
          <h3 class="text-main fw-bold mb-0">{{ low_stock_count }}</h3>
          <span class="text-danger small mt-2">
            {% if low_stock_count > 0 %}
            <i class="fas fa-arrow-down me-1"></i>Requiere atenci칩n
            {% else %}
            <i class="fas fa-check me-1"></i>Todo en orden
            {% endif %}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="row mb-5 animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
    <div class="col-lg-8 mx-auto">
      <div class="glass-effect p-2 rounded-pill d-flex align-items-center ps-4 pe-2 shadow-lg border border-opacity-10"
        style="border-color: var(--border-color);">
        <i class="fas fa-search text-muted me-3"></i>
        <input type="text" id="buscar" class="form-control bg-transparent border-0 text-main shadow-none"
          placeholder="Buscar productos por nombre, c칩digo..." hx-get="{% url 'buscar_productos_htmx' %}"
          hx-trigger="keyup changed delay:300ms" hx-target="#productos-container" hx-include="[name='buscar']"
          hx-swap="innerHTML" name="buscar" style="font-size: 1.1rem;">
      </div>
    </div>
  </div>

  <!-- Product Grid -->
  <div id="productos-container" class="productos-grid animate__animated animate__fadeInUp"
    style="animation-delay: 0.2s;">
    {% include "tienda/partials/productos_cards.html" with productos=productos %}
  </div>

</div>

<style>
  .productos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 1.5rem;
    padding-bottom: 2rem;
  }
</style>
{% endblock %}